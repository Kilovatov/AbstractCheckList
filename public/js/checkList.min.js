!function(e,t){function n(e){return function(t){for(var n in t){var a="{{\\s?"+n+"\\s?}}";e=e.replace(new RegExp(a,"ig"),t[n])}return e}}function a(){e.getElementById("save")&&(e.getElementById("save").click(),L())}function l(e){var t=document.createElement("form");t.name="create",t.classList.add("form-inline");for(var a=0;a<_.length;a++){var l=document.createElement("div");l.classList.add("form-group"),l.innerHTML=n('<label>{{ label }}</label><input type={{ myType }} class="form-control"placeholder={{myPlaceholder}} name="myName" required>')({label:_[a].label,myType:_[a].type,myPlaceholder:_[a].placeholder,myName:_[a].name}),t.appendChild(l)}var i=document.createElement("button");i.classList.add("btn"),i.classList.add("btn-default"),i.innerHTML="create",t.appendChild(i),e.appendChild(t)}function i(e,t){var a=document.createElement("nav");a.classList.add("nav"),a.classList.add("nav-tabs");for(var l=0;l<x.list.length;l++){var i=document.createElement("li");i.classList.add("tab__control__item"),i.innerHTML=n('<a href="#">{{ title }}</a>')({title:x.list[l].name}),a.appendChild(i),x.list[l].name==t&&i.classList.add("active")}e.appendChild(a)}function o(e){var t=n('<section class="task"><input type="checkbox" {{checked}}><p>{{ task }}</p><button class="btn btn-default" name="del">delete</button><button type="button" class="btn btn-default" name="move">move to</button><button type="button" class="btn btn-default" name="edit">edit</button></section>');k.innerHTML+=t({task:e.texts,checked:e.done?"checked":""})}function s(e,t){k.innerHTML="";for(var n=0;n<t.length;n++)o(t[n]);e.appendChild(k),c()}function c(){localStorage.setItem(E,JSON.stringify(C.scheme)),localStorage.setItem(N,JSON.stringify(C.list))}function r(e){d("tab__control__item"),e.classList.add("active");for(var t=0;t<x.list.length;t++)x.list[t].name==e.textContent&&m(k,x.list[t].condition)}function d(e){for(var t=document.querySelectorAll("."+e),n=0;n<t.length;n++)t[n].classList.remove("active")}function u(){var e=document.querySelector(".active");r(e)}function m(e,t){for(var n=0;n<C.list.length;n++)e.childNodes[n].style.display=t(C.list[n])?"block":"none"}function f(e){console.log("hi!");for(var t=[],n=0;n<e.elements.length;n++)t[n]="date"==e.elements[n].type?new Date(e.elements[n].value):e.elements[n].value?e.elements[n].value:!1;var a=new D(t);C.list.push(a),e.reset(),o(a)}function v(e){a();for(var t=C.list.length-1;t>=0;t--)if(e.childNodes[1].textContent==C.list[t].texts){C.list.splice(t,1),e.remove(),c();break}}function h(e){a();var t=e.childNodes[1].textContent;e.innerHTML="";var n=document.createElement("input"),l=document.createElement("label");l.innerHTML="'"+t+"'   till",e.appendChild(l),n.type="date",n.classList.add("form-control"),e.appendChild(n);var i=document.createElement("button");i.textContent="move deadline",i.classList.add("btn-default"),i.classList.add("btn"),i.id="save",e.appendChild(i),e.classList.add("form-inline"),i.onclick=function(){for(var a=0;a<C.list.length;a++)if(t==C.list[a].texts&&""!=n.value){C.list[a].deadline=new Date(n.value),c(),s(e.parentNode.parentNode,C.list),u();break}L()}}function p(e){a();var t=e.parentNode,n=t.childNodes[1].textContent;t.innerHTML="";var l=document.createElement("input");l.value=n,l.setAttribute("class","form-control change-task"),t.appendChild(l);var i=document.createElement("button");i.textContent="save",i.classList.add("btn-default"),i.classList.add("btn"),i.id="save",t.appendChild(i),i.onclick=function(){for(var e=0;e<C.list.length;e++)if(n==C.list[e].texts&&""!=l.value){C.list[e].texts=l.value,c(),s(t.parentNode.parentNode,C.list),u();break}L()}}function g(e){a();for(var t=C.list.length-1;t>=0;t--)if(e.childNodes[1].textContent==C.list[t].texts){C.list[t].done=!C.list[t].done,c(),u();break}}function b(e){return function(t){return new Date(t.deadline)<e&&new Date(t.deadline)>new Date&&!y()(t)?!0:!1}}function y(){return function(e){return e.done}}function L(){for(var t=e.getElementsByClassName("tab__control__item"),n=0;n<t.length;n++)t[n].addEventListener("click",function(){console.log(this),d("tab__control__item"),this.classList.add("active");for(var e=0;e<x.list.length;e++)x.list[e].name==this.textContent&&m(k,x.list[e].condition)});var a=e.getElementsByName("create")[0];console.log(a),a.onsubmit=function(e){f(this),c(),u(),L(),e.preventDefault()};for(var l=e.querySelectorAll("input[type=checkbox]"),n=0;n<l.length;n++)l[n].addEventListener("click",function(){g(this.parentNode)});for(var i=e.getElementsByName("del"),n=0;n<i.length;n++)i[n].addEventListener("click",function(){v(this.parentNode)});for(var o=e.getElementsByName("move"),n=0;n<o.length;n++)o[n].addEventListener("click",function(){h(this.parentNode)});for(var s=e.getElementsByName("edit"),n=0;n<s.length;n++)s[n].addEventListener("click",function(){p(this)})}var k=document.createElement("div"),E="_StorageScheme",N="_StorageList",C=localStorage.getItem(N)?{scheme:JSON.parse(localStorage.getItem(E)),list:JSON.parse(localStorage.getItem(N))}:{scheme:{texts:"string",deadline:"date",done:"boolean"},list:[]},x={scheme:{name:"string",condition:"function"},list:[{name:"Today",condition:b((new Date).setDate((new Date).getDate()+1))},{name:"Week",condition:b((new Date).setDate((new Date).getDate()+7))},{name:"All",condition:function(e){return!y()(e)}},{name:"Done",condition:y()}]},_=[{label:"",type:"text",name:"text",placeholder:"Task"},{label:"till",type:"date",name:"till",placeholder:new Date}],D=function(e){for(var t=Object.keys(C.scheme),n=0;n<e.length;n++){var a=t[n];this[a]=e[n]}};t.startToDo=function(e){l(e),i(e,"All"),s(e,C.list),u(),L()},e.onkeyup=function(e){13===e.keyCode&&a()}}(document,window);