var checkList=function(e){function t(e){return function(t){for(var n in t){var a="{{\\s?"+n+"\\s?}}";e=e.replace(new RegExp(a,"ig"),t[n])}return e}}function n(){e.getElementById("save")&&e.getElementById("save").click()}function a(e){var n=document.createElement("form");n.name="create",n.classList.add("form-inline");for(var a=0;a<x.length;a++){var i=document.createElement("div");i.classList.add("form-group"),i.innerHTML=t('<label>{{ label }}</label><input type={{ myType }} class="form-control"placeholder={{myPlaceholder}} name="myName" required>')({label:x[a].label,myType:x[a].type,myPlaceholder:x[a].placeholder,myName:x[a].name}),n.appendChild(i)}var o=document.createElement("button");o.classList.add("btn"),o.classList.add("btn-default"),o.innerHTML="create",n.appendChild(o),e.appendChild(n),l(e,"All")}function l(e,n){var a=document.createElement("nav");a.classList.add("nav"),a.classList.add("nav-tabs");for(var l=0;l<C.list.length;l++){var i=document.createElement("li");i.classList.add("tab__control__item"),i.innerHTML=t('<a href="#">{{ title }}</a>')({title:C.list[l].name}),a.appendChild(i),C.list[l].name==n&&i.classList.add("active")}e.appendChild(a),o(e,N.list)}function i(e){var n=t('<section class="task"><input type="checkbox" {{checked}}><p>{{ task }}</p><button class="btn btn-default" name="del">delete</button><button type="button" class="btn btn-default" name="move">move to</button><button type="button" class="btn btn-default" name="edit">edit</button></section>');L.innerHTML+=n({task:e.texts,checked:e.done?"checked":""})}function o(e,t){L.innerHTML="";for(var n=0;n<t.length;n++)i(t[n]);e.appendChild(L),s(),d()}function s(){localStorage.setItem(k,JSON.stringify(N.scheme)),localStorage.setItem(E,JSON.stringify(N.list))}function c(e){r("tab__control__item"),e.classList.add("active");for(var t=0;t<C.list.length;t++)C.list[t].name==e.textContent&&u(L,C.list[t].condition)}function r(e){for(var t=document.querySelectorAll("."+e),n=0;n<t.length;n++)t[n].classList.remove("active")}function d(){var e=document.querySelector(".active");c(e)}function u(e,t){for(var n=0;n<N.list.length;n++)e.childNodes[n].style.display=t(N.list[n])?"block":"none"}function m(e){for(var t=[],n=0;n<e.elements.length;n++)t[n]="date"==e.elements[n].type?new Date(e.elements[n].value):e.elements[n].value?e.elements[n].value:!1;var a=new _(t);N.list.push(a),e.reset(),i(a)}function f(e){n();for(var t=N.list.length-1;t>=0;t--)if(e.childNodes[1].textContent==N.list[t].texts){N.list.splice(t,1),e.remove(),s();break}}function v(e){n();var t=e.childNodes[1].textContent;e.innerHTML="";var a=document.createElement("input"),l=document.createElement("label");l.innerHTML="'"+t+"'   till",e.appendChild(l),a.type="date",a.classList.add("form-control"),e.appendChild(a);var i=document.createElement("button");i.textContent="move deadline",i.classList.add("btn-default"),i.classList.add("btn"),i.id="save",e.appendChild(i),e.classList.add("form-inline"),i.onclick=function(){for(var n=0;n<N.list.length;n++)if(t==N.list[n].texts&&""!=a.value){N.list[n].deadline=new Date(a.value),s(),o(e.parentNode.parentNode,N.list),d();break}y()}}function h(e){n();var t=e.parentNode,a=t.childNodes[1].textContent;t.innerHTML="";var l=document.createElement("input");l.value=a,l.setAttribute("class","form-control change-task"),t.appendChild(l);var i=document.createElement("button");i.textContent="save",i.classList.add("btn-default"),i.classList.add("btn"),i.id="save",t.appendChild(i),i.onclick=function(){for(var e=0;e<N.list.length;e++)if(a==N.list[e].texts&&""!=l.value){N.list[e].texts=l.value,s(),o(t.parentNode.parentNode,N.list),d();break}y()}}function p(e){n();for(var t=N.list.length-1;t>=0;t--)if(e.childNodes[1].textContent==N.list[t].texts){N.list[t].done=!N.list[t].done,s(),d();break}}function b(e){return function(t){return new Date(t.deadline)<e&&new Date(t.deadline)>new Date&&!g()(t)?!0:!1}}function g(){return function(e){return e.done}}function y(){for(var t=e.getElementsByClassName("tab__control__item"),n=0;n<t.length;n++)t[n].addEventListener("click",function(){r("tab__control__item"),this.classList.add("active");for(var e=0;e<C.list.length;e++)C.list[e].name==this.textContent&&u(L,C.list[e].condition)});var a=e.getElementsByName("create")[0];a.onsubmit=function(e){m(this),s(),d(),y(),e.preventDefault()};for(var l=e.querySelectorAll("input[type=checkbox]"),n=0;n<l.length;n++)l[n].addEventListener("click",function(){p(this.parentNode)});for(var i=e.getElementsByName("del"),n=0;n<i.length;n++)i[n].addEventListener("click",function(){f(this.parentNode)});for(var o=e.getElementsByName("move"),n=0;n<o.length;n++)o[n].addEventListener("click",function(){v(this.parentNode)});for(var c=e.getElementsByName("edit"),n=0;n<c.length;n++)c[n].addEventListener("click",function(){h(this)})}var L=document.createElement("div"),k="_StorageScheme",E="_StorageList",N=localStorage.getItem(E)?{scheme:JSON.parse(localStorage.getItem(k)),list:JSON.parse(localStorage.getItem(E))}:{scheme:{texts:"string",deadline:"date",done:"boolean"},list:[]},C={scheme:{name:"string",condition:"function"},list:[{name:"Today",condition:b((new Date).setDate((new Date).getDate()+1))},{name:"Week",condition:b((new Date).setDate((new Date).getDate()+7))},{name:"All",condition:function(e){return!g()(e)}},{name:"Done",condition:g()}]},x=[{label:"",type:"text",name:"text",placeholder:"Task"},{label:"till",type:"date",name:"till",placeholder:new Date}],_=function(e){for(var t=Object.keys(N.scheme),n=0;n<e.length;n++){var a=t[n];this[a]=e[n]}};e.onkeyup=function(e){13===e.keyCode&&(console.log("ENTER!"),n())};var D=function(e){a(e),y()};return D}(document);