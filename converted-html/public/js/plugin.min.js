!function(){function t(){var t,e,s;t="string"==typeof this.options.content?this.options.content:this.options.content.innerHTML,s=document.createDocumentFragment(),this.modal=document.createElement("div"),this.modal.className="scotch-modal "+this.options.className,this.modal.style.minWidth=this.options.minWidth+"px",this.modal.style.maxWidth=this.options.maxWidth+"px",this.options.closeButton===!0&&(this.closeButton=document.createElement("button"),this.closeButton.className="scotch-close close-button",this.closeButton.innerHTML="&times;",this.modal.appendChild(this.closeButton)),this.options.overlay===!0&&(this.overlay=document.createElement("div"),this.overlay.className="scotch-overlay "+this.options.className,s.appendChild(this.overlay)),e=document.createElement("div"),e.className="scotch-content",e.innerHTML=t,this.modal.appendChild(e),s.appendChild(this.modal),document.body.appendChild(s)}function e(t,e){var s;for(s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t}function s(){this.closeButton&&this.closeButton.addEventListener("click",this.close.bind(this)),this.overlay&&this.overlay.addEventListener("click",this.close.bind(this))}function n(){var t=document.createElement("div");return t.style.WebkitTransition?"webkitTransitionEnd":t.style.OTransition?"oTransitionEnd":"transitionend"}this.Modal=function(){this.closeButton=null,this.modal=null,this.overlay=null,this.transitionEnd=n();var t={autoOpen:!1,className:"fade-and-drop",closeButton:!0,content:"",maxWidth:600,minWidth:280,overlay:!0};arguments[0]&&"object"==typeof arguments[0]&&(this.options=e(t,arguments[0])),this.options.autoOpen===!0&&this.open()},Modal.prototype.close=function(){var t=this;this.modal.className=this.modal.className.replace(" scotch-open",""),this.overlay.className=this.overlay.className.replace(" scotch-open",""),this.modal.addEventListener(this.transitionEnd,function(){t.modal.parentNode.removeChild(t.modal)}),this.overlay.addEventListener(this.transitionEnd,function(){t.overlay.parentNode&&t.overlay.parentNode.removeChild(t.overlay)})},Modal.prototype.open=function(){t.call(this),s.call(this),window.getComputedStyle(this.modal).height,this.modal.className=this.modal.className+(this.modal.offsetHeight>window.innerHeight?" scotch-open scotch-anchored":" scotch-open"),this.overlay.className=this.overlay.className+" scotch-open"}}(),function(){function t(t){for(var e=document.querySelectorAll("."+t),s=0;s<e.length;s++)e[s].classList.remove("active")}function e(t){return function(e){return new Date(e.deadline)<t&&new Date(e.deadline)>new Date&&!s()(e)?!0:!1}}function s(){return function(t){return t.done}}this.CheckList=function(){this.toDo=document.createElement("div"),this.keyScheme="_StorageScheme",this.keyList="_StorageList",this.tasks=localStorage.getItem(this.keyList)?{scheme:JSON.parse(localStorage.getItem(this.keyScheme)),list:JSON.parse(localStorage.getItem(this.keyList))}:{scheme:{texts:"string",deadline:"date",done:"boolean"},list:[]},this.tabs={scheme:{name:"string",condition:"function"},list:[{name:"Today",condition:e((new Date).setDate((new Date).getDate()+1))},{name:"Week",condition:e((new Date).setDate((new Date).getDate()+7))},{name:"All",condition:function(t){return!s()(t)}},{name:"Done",condition:s()}]},this.formDefault=[{label:"",type:"text",name:"text",placeholder:"Task"},{label:"till",type:"date",name:"till",placeholder:new Date}],this.templater=function(t){return function(e){for(var s in e){var n="{{\\s?"+s+"\\s?}}";t=t.replace(new RegExp(n,"ig"),e[s])}return t}},this.Task=function(t){for(var e=Object.keys(myThis.tasks.scheme),s=0;s<t.length;s++){var n=e[s];this[n]=t[s]}}},CheckList.prototype.startToDo=function(t){this.renderForm(t),this.renderPanel(t,"All"),this.renderList(t,this.tasks.list),this.refresh()},CheckList.prototype.safePush=function(){document.getElementById("save")&&document.getElementById("save").click()},CheckList.prototype.renderForm=function(t){var e=document.createElement("form");e.name="create",e.setAttribute("onsubmit","myThis.createTask(this); return false;"),e.classList.add("form-inline");for(var s=0;s<this.formDefault.length;s++){var n=document.createElement("div");n.classList.add("form-group"),n.innerHTML=this.templater('<label>{{ label }}</label><input type={{ myType }} class="form-control"placeholder={{myPlaceholder}} name="myName" required>')({label:this.formDefault[s].label,myType:this.formDefault[s].type,myPlaceholder:this.formDefault[s].placeholder,myName:this.formDefault[s].name}),e.appendChild(n)}var i=document.createElement("button");i.classList.add("btn"),i.classList.add("btn-default"),i.innerHTML="create",e.appendChild(i),t.appendChild(e)},CheckList.prototype.renderPanel=function(t,e){console.log(myThis);var s=document.createElement("nav");s.classList.add("nav"),s.classList.add("nav-tabs");for(var n=0;n<this.tabs.list.length;n++){var i=document.createElement("li");i.classList.add("tab__control__item");i.innerHTML=this.templater('<a href="#" onclick="myThis.activePanel(this.parentNode)">{{ title }}</a>')({title:this.tabs.list[n].name}),s.appendChild(i),this.tabs.list[n].name==e&&i.classList.add("active")}t.appendChild(s)},CheckList.prototype.renderTask=function(t){var e=this.templater('<section class="task"><input type="checkbox" {{checked}} onclick="myThis.check(this.parentNode)"><p>{{ task }}</p><button class="btn btn-default" onclick="myThis.del(this.parentNode)">delete</button><button type="button" class="btn btn-default" onclick="myThis.mv(this.parentNode)">move to</button><button type="button" class="btn btn-default" onclick="myThis.edt(this,parentNode)">edit</button></section>');this.toDo.innerHTML+=e({task:t.texts,checked:t.done?"checked":""})},CheckList.prototype.renderList=function(t,e){this.toDo.innerHTML="";for(var s=0;s<e.length;s++)this.renderTask(e[s]);t.appendChild(this.toDo),this.save()},CheckList.prototype.save=function(){localStorage.setItem(this.keyScheme,JSON.stringify(this.tasks.scheme)),localStorage.setItem(this.keyList,JSON.stringify(this.tasks.list))},CheckList.prototype.activePanel=function(e){t("tab__control__item"),e.classList.add("active");for(var s=0;s<this.tabs.list.length;s++)this.tabs.list[s].name==e.textContent&&this.showItems(this.toDo,this.tabs.list[s].condition)},CheckList.prototype.refresh=function(){var t=document.querySelector(".active");this.activePanel(t)},CheckList.prototype.showItems=function(t,e){for(var s=0;s<this.tasks.list.length;s++)t.childNodes[s].style.display=e(this.tasks.list[s])?"block":"none"},CheckList.prototype.createTask=function(t){for(var e=[],s=0;s<t.elements.length;s++)e[s]="date"==t.elements[s].type?new Date(t.elements[s].value):t.elements[s].value?t.elements[s].value:!1;var n=new this.Task(e);this.tasks.list.push(n),t.reset(),this.renderTask(n)},CheckList.prototype.del=function(t){this.safePush();for(var e=this.tasks.list.length-1;e>=0;e--)if(t.childNodes[1].textContent==this.tasks.list[e].texts){this.tasks.list.splice(e,1),t.remove(),this.save();break}},CheckList.prototype.mv=function(t){this.safePush();var e=t.childNodes[1].textContent;t.innerHTML="";var s=document.createElement("input"),n=document.createElement("label");n.innerHTML="'"+e+"'   till",t.appendChild(n),s.type="date",s.classList.add("form-control"),t.appendChild(s);var i=document.createElement("button");i.textContent="move deadline",i.classList.add("btn-default"),i.classList.add("btn"),i.id="save",t.appendChild(i),t.classList.add("form-inline"),i.onclick=function(){for(var n=0;n<myThis.tasks.list.length;n++)if(e==myThis.tasks.list[n].texts&&""!=s.value){myThis.tasks.list[n].deadline=new Date(s.value),myThis.save(),myThis.renderList(t.parentNode.parentNode,myThis.tasks.list),myThis.refresh();break}}},CheckList.prototype.edt=function(t){this.safePush();var e=t.parentNode,s=e.childNodes[1].textContent;e.innerHTML="";var n=document.createElement("input");n.value=s,n.setAttribute("class","form-control change-task"),e.appendChild(n);var i=document.createElement("button");i.textContent="save",i.classList.add("btn-default"),i.classList.add("btn"),i.id="save",e.appendChild(i),i.onclick=function(){for(var t=0;t<myThis.tasks.list.length;t++)if(s==myThis.tasks.list[t].texts&&""!=n.value){myThis.tasks.list[t].texts=n.value,myThis.save(),myThis.renderList(e.parentNode.parentNode,myThis.tasks.list),myThis.refresh();break}}},CheckList.prototype.check=function(t){this.safePush();for(var e=this.tasks.list.length-1;e>=0;e--)if(t.childNodes[1].textContent==this.tasks.list[e].texts){this.tasks.list[e].done=!this.tasks.list[e].done,this.save(),this.refresh();break}}}();var myContent=document.getElementById("content"),myModal=new Modal({content:myContent,className:"zoom"}),myCheckList=new CheckList,myThis=myCheckList,triggerButton=document.getElementById("trigger");triggerButton.addEventListener("click",function(){myModal.open();var t=document.getElementsByClassName("scotch-content")[0];myCheckList.startToDo(t)}),document.onkeyup=function(t){13===t.keyCode&&myCheckList.safePush()};